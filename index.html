<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thống kê phụ tùng</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <!-- ẢNH Ô TÔ ĐẸP -->
      <img class="truck" id="headerTruck" alt="ô tô đầu kéo"
        src="https://images.unsplash.com/photo-1542362567-b07e54358753?auto=format&fit=crop&w=560&q=70">
      <div>
        <div class="title">THỐNG KÊ PHỤ TÙNG</div>
        <div class="subtitle">Kho & Cửa hàng • Nhập/Xuất theo OEM • Báo giá PDF</div>
      </div>
    </div>

    <div class="header-right">
      <button class="tab-btn active" data-tab="KHO">KHO</button>
      <button class="tab-btn" data-tab="CUA_HANG">CỬA HÀNG</button>
      <button class="tab-btn" id="btnToken">TOKEN</button>
    </div>
  </header>

  <main class="container">
    <section class="toolbar">
      <div class="search-wrap">
        <button class="big-btn" id="btnQuote">BÁO GIÁ</button>
        <input id="q" class="search" placeholder="Tra theo OEM / OEM thay thế / Tên / Loại..." />
        <button id="btnSearch" class="btn">Tra cứu</button>
        <button id="btnRefresh" class="btn ghost">Làm mới</button>
      </div>

      <div class="actions">
        <button id="btnOpenAdd" class="btn">+ Thêm sản phẩm</button>
        <button id="btnOpenIn" class="btn">Nhập hàng</button>
        <button id="btnOpenOut" class="btn danger">Xuất hàng</button>
      </div>
    </section>

    <section class="statline">
      <div>Đang xem: <b id="viewLoc">KHO</b></div>
      <div class="muted">Không tra: trượt theo loại • Có tra: ALL danh sách</div>
    </section>

    <section id="categoryRows" class="category-rows"></section>

    <section class="list" id="listSection">
      <div class="list-head">
        <div class="muted">Kết quả tra cứu (ALL)</div>
        <div class="pill">Đã chọn báo giá: <b id="quoteCount">0</b></div>
      </div>
      <div id="list" class="list-body"></div>
    </section>
  </main>

  <!-- TOKEN -->
  <div class="modal" id="modalToken">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Nhập TOKEN</div>
        <button class="icon-btn" data-close="#modalToken">✕</button>
      </div>
      <div class="grid">
        <label class="full">TOKEN
          <input id="app_token" placeholder="Dán token của bạn vào đây..." />
        </label>
        <div class="full muted">Token lưu trên thiết bị (localStorage). Đổi máy thì nhập lại.</div>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" data-close="#modalToken">Hủy</button>
        <button class="btn" id="btnSaveToken">Lưu TOKEN</button>
      </div>
    </div>
  </div>

  <!-- ADD PRODUCT -->
  <div class="modal" id="modalAdd">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Thêm sản phẩm</div>
        <button class="icon-btn" data-close="#modalAdd">✕</button>
      </div>

      <div class="grid">
        <label>OEM <input id="p_oem"/></label>
        <label>OEM THAY THẾ <input id="p_alt"/></label>
        <label class="full">TÊN <input id="p_ten"/></label>
        <label>THƯƠNG HIỆU <input id="p_brand"/></label>
        <label>LOẠI <input id="p_loai" placeholder="VD: Lọc nhớt"/></label>
        <label>ĐƠN VỊ TÍNH <input id="p_dvt" placeholder="cái, lọ, bộ..."/></label>
        <label>GIÁ <input id="p_gia" inputmode="numeric" placeholder="VD: 120000"/></label>
        <label>GHI CHÚ <input id="p_note"/></label>

        <label>Tồn ban đầu KHO <input id="p_init_kho" inputmode="numeric" placeholder="VD: 10"/></label>
        <label>Tồn ban đầu CỬA HÀNG <input id="p_init_store" inputmode="numeric" placeholder="VD: 0"/></label>

        <label class="full">
          Ảnh (Camera/Điện thoại/PC)
          <input id="p_img" type="file" accept="image/*" capture="environment"/>
        </label>

        <div class="full img-preview-wrap">
          <div class="muted">Xem trước ảnh:</div>
          <img id="p_img_preview" class="img-preview" alt="preview" />
        </div>

        <div class="full muted">* OEM thay thế có thể để trống và không bắt buộc ảnh</div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" data-close="#modalAdd">Hủy</button>
        <button id="btnSaveProduct" class="btn">Lưu sản phẩm</button>
      </div>
    </div>
  </div>

  <!-- MOVEMENT -->
  <div class="modal" id="modalMove">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title" id="moveTitle">Nhập/Xuất</div>
        <button class="icon-btn" data-close="#modalMove">✕</button>
      </div>

      <div class="grid">
        <label>Chọn nơi (Location)
          <select id="m_location" class="select">
            <option value="KHO">KHO</option>
            <option value="CUA_HANG">CỬA HÀNG</option>
          </select>
        </label>
        <label>Mã OEM <input id="m_oem" placeholder="VD: 12345-ABC"/></label>
        <label>Số lượng <input id="m_qty" inputmode="numeric" placeholder="VD: 2"/></label>
        <label id="priceWrap">Cập nhật giá mới (chỉ khi NHẬP)
          <input id="m_new_price" inputmode="numeric" placeholder="Để trống = giữ giá cũ"/>
        </label>
        <label class="full">Ghi chú <input id="m_note" placeholder="VD: Nhập theo hoá đơn..."/></label>
        <div class="full muted">* Nếu nhập giá mới: tất cả sản phẩm cùng OEM sẽ đổi giá.</div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" data-close="#modalMove">Hủy</button>
        <button id="btnDoMove" class="btn">Xác nhận</button>
      </div>
    </div>
  </div>

  <!-- QUOTE -->
  <div class="modal" id="modalQuote">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Báo giá (PDF)</div>
        <button class="icon-btn" data-close="#modalQuote">✕</button>
      </div>

      <div class="grid">
        <label>Khách hàng <input id="c_name" placeholder="Tên khách"/></label>
        <label>SĐT <input id="c_phone" placeholder="Số điện thoại"/></label>
        <label class="full">Địa chỉ <input id="c_addr" placeholder="Địa chỉ"/></label>
      </div>

      <div class="quote-items" id="quoteItems"></div>

      <div class="modal-actions">
        <button id="btnClearQuote" class="btn ghost">Xoá chọn</button>
        <button id="btnMakePdf" class="btn">Tạo PDF báo giá</button>
      </div>

      <div class="result" id="quoteResult"></div>
    </div>
  </div>

  <!-- PRODUCT DETAIL -->
  <div class="modal" id="modalDetail">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Chi tiết sản phẩm</div>
        <button class="icon-btn" data-close="#modalDetail">✕</button>
      </div>

      <div class="detail-top">
        <img id="d_img" class="detail-img" alt="image"/>
        <div class="detail-info">
          <div class="detail-oem">
            <span id="d_oem"></span>
            <span class="muted">(#<span id="d_id"></span>)</span>
          </div>
          <div class="muted">OEM thay thế: <b id="d_alt"></b></div>
          <div class="detail-name" id="d_ten"></div>
          <div class="detail-meta">
            <div>Loại: <b id="d_loai"></b></div>
            <div>Thương hiệu: <b id="d_brand"></b></div>
            <div>ĐVT: <b id="d_dvt"></b></div>
            <div>Giá: <b id="d_gia"></b></div>
          </div>
          <div class="detail-stock">
            <div class="pill">Tồn KHO: <b id="d_ton_kho">0</b></div>
            <div class="pill">Tồn CỬA HÀNG: <b id="d_ton_store">0</b></div>
          </div>
        </div>
      </div>

      <hr class="sep"/>

      <div class="grid">
        <label>OEM <input id="e_oem" disabled /></label>
        <label>OEM THAY THẾ <input id="e_alt" disabled /></label>
        <label class="full">TÊN <input id="e_ten" disabled /></label>
        <label>THƯƠNG HIỆU <input id="e_brand" disabled /></label>
        <label>LOẠI <input id="e_loai" disabled /></label>
        <label>ĐVT <input id="e_dvt" disabled /></label>

        <label>GIÁ <input id="e_gia" inputmode="numeric" disabled /></label>
        <label>Áp giá theo OEM (đổi tất cả cùng OEM)
          <select id="e_apply_oem_price" class="select" disabled>
            <option value="0">Không</option>
            <option value="1">Có</option>
          </select>
        </label>

        <label class="full">GHI CHÚ <input id="e_note" disabled /></label>

        <label class="full">Đổi ảnh
          <input id="e_img" type="file" accept="image/*" capture="environment" disabled />
        </label>
        <div class="full muted">* Bấm “Sửa” để cho phép chỉnh.</div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="btnAddToQuoteFromDetail">+ Thêm vào báo giá</button>
        <button class="btn" id="btnEditDetail">Sửa</button>
        <button class="btn" id="btnSaveDetail" disabled>Lưu cập nhật</button>
      </div>

      <div class="repl">
        <div class="repl-title">Sản phẩm thay thế / liên quan</div>
        <div class="repl-list" id="replList"></div>
      </div>
    </div>
  </div>

  <footer class="app-footer">
    <div class="marquee">
      <div class="marquee__inner">
        <span class="footer-badge">@2025 hải võ • Thống kê phụ tùng • Nhập/Xuất theo OEM • Báo giá PDF • </span>
        <span class="footer-badge">@2025 hải võ • Thống kê phụ tùng • Nhập/Xuất theo OEM • Báo giá PDF • </span>
      </div>
    </div>
  </footer>

  <div id="toastWrap" class="toast-wrap"></div>

  <script src="./app.js"></script>
</body>
</html>
